<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>贪吃蛇对战 - 玩家VS电脑</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        player: '#22c55e', // 玩家蛇：绿色
                        ai: '#3b82f6',     // 电脑蛇：蓝色
                        food: '#ef4444',   // 食物：红色
                        dark: '#1e293b',   // 深色背景
                    },
                    fontFamily: {
                        game: ['"Press Start 2P"', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .game-shadow {
                box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
            }
            .pulse-animation {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .screen-transition {
                transition: opacity 0.3s ease, visibility 0.3s ease;
            }
            .control-btn {
                @apply flex items-center justify-center rounded-full bg-player/30 active:bg-player/60 
                       shadow-lg active:shadow-player/50 transition-all duration-150
                       touch-manipulation select-none;
            }
            @keyframes pulse {
                0%, 100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.7;
                }
            }
        }
    </style>
    
    <!-- 导入游戏字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-dark to-slate-800 min-h-screen text-white flex flex-col items-center justify-start p-4 font-game">
    <div class="max-w-3xl w-full mx-auto">
        <!-- 游戏标题 -->
        <h1 class="text-[clamp(1.2rem,5vw,2rem)] text-center my-4 text-player pulse-animation">贪吃蛇对战</h1>
        
        <!-- 游戏信息区域 -->
        <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-2">
            <div class="bg-slate-700/50 px-3 py-1.5 rounded-lg flex items-center gap-2 text-sm sm:text-base">
                <i class="fa fa-user text-player"></i>
                <span>玩家分数: <span id="playerScore" class="text-player">0</span></span>
            </div>
            <div class="bg-slate-700/50 px-3 py-1.5 rounded-lg flex items-center gap-2 text-sm sm:text-base">
                <i class="fa fa-robot text-ai"></i>
                <span>电脑分数: <span id="aiScore" class="text-ai">0</span></span>
            </div>
            <div class="flex gap-2">
                <button id="startBtn" class="bg-player hover:bg-player/80 text-white px-3 py-1.5 rounded-lg transition-all flex items-center gap-2 text-sm">
                    <i class="fa fa-play"></i>
                    <span>开始</span>
                </button>
                <button id="pauseBtn" class="bg-slate-600 hover:bg-slate-500 text-white px-3 py-1.5 rounded-lg transition-all flex items-center gap-2 text-sm" disabled>
                    <i class="fa fa-pause"></i>
                    <span>暂停</span>
                </button>
            </div>
        </div>
        
        <!-- 游戏容器 -->
        <div class="relative mx-auto bg-slate-900 rounded-lg p-1 game-shadow">
            <canvas id="gameCanvas" class="w-full h-auto rounded"></canvas>
            
            <!-- 游戏开始提示 -->
            <div id="startScreen" class="absolute inset-0 flex flex-col items-center justify-center bg-dark/80 rounded-lg screen-transition">
                <p class="text-lg sm:text-xl mb-4 text-center px-4">按<span class="text-player">开始</span>按钮开始游戏</p>
                <p class="text-xs sm:text-sm text-slate-400 text-center px-4">
                    玩家蛇: <span class="text-player">绿色</span> | 电脑蛇: <span class="text-ai">蓝色</span><br>
                    电脑蛇可穿墙，仅头部相撞时游戏结束
                </p>
            </div>
            
            <!-- 游戏结束提示 -->
            <div id="gameOverScreen" class="absolute inset-0 flex flex-col items-center justify-center bg-dark/80 rounded-lg screen-transition opacity-0 invisible">
                <p class="text-xl sm:text-2xl mb-2 text-food">游戏结束!</p>
                <p class="text-base sm:text-xl mb-2">你的分数: <span id="finalPlayerScore">0</span></p>
                <p class="text-base sm:text-xl mb-4">电脑分数: <span id="finalAiScore">0</span></p>
                <button id="restartBtn" class="bg-player hover:bg-player/80 text-white px-4 py-2 rounded-lg transition-all transform hover:scale-105">
                    再来一局
                </button>
            </div>
        </div>
        
        <!-- 移动设备虚拟按键 (仅在小屏幕显示) -->
        <div class="mt-6 md:hidden">
            <div class="flex justify-center mb-2">
                <!-- 上键 -->
                <button id="upBtn" class="control-btn w-16 h-16 text-xl">
                    <i class="fa fa-arrow-up"></i>
                </button>
            </div>
            <div class="flex justify-center gap-2">
                <!-- 左键 -->
                <button id="leftBtn" class="control-btn w-16 h-16 text-xl">
                    <i class="fa fa-arrow-left"></i>
                </button>
                <!-- 下键 -->
                <button id="downBtn" class="control-btn w-16 h-16 text-xl">
                    <i class="fa fa-arrow-down"></i>
                </button>
                <!-- 右键 -->
                <button id="rightBtn" class="control-btn w-16 h-16 text-xl">
                    <i class="fa fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- 游戏说明 -->
        <div class="mt-6 bg-slate-700/30 p-3 rounded-lg text-xs sm:text-sm">
            <h2 class="text-player mb-2">游戏说明:</h2>
            <ul class="list-disc pl-5 space-y-1">
                <li>玩家控制<span class="text-player">绿色蛇</span>，与<span class="text-ai">蓝色电脑蛇</span>对抗</li>
                <li>每5秒会生成2个红色食物，吃到食物得分并增长</li>
                <li><span class="text-player">玩家蛇</span>撞到墙壁、自己身体会死亡</li>
                <li><span class="text-ai">电脑蛇</span>可以穿过墙壁，不会因此死亡</li>
                <li>只有两条蛇的头部相撞时，游戏才会结束</li>
                <li>随着时间推移，两条蛇的移动速度都会加快</li>
            </ul>
        </div>
    </div>

    <script>
        // 获取DOM元素
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const playerScoreElement = document.getElementById('playerScore');
        const aiScoreElement = document.getElementById('aiScore');
        const startBtn = document.getElementById('startBtn');
        const pauseBtn = document.getElementById('pauseBtn');
        const restartBtn = document.getElementById('restartBtn');
        const startScreen = document.getElementById('startScreen');
        const gameOverScreen = document.getElementById('gameOverScreen');
        const finalPlayerScoreElement = document.getElementById('finalPlayerScore');
        const finalAiScoreElement = document.getElementById('finalAiScore');
        // 虚拟按键
        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');
        
        // 设置Canvas尺寸
        function resizeCanvas() {
            const containerWidth = canvas.parentElement.clientWidth;
            const ratio = window.innerWidth < 640 ? 0.9 : 0.75;
            const newWidth = containerWidth;
            const newHeight = Math.floor(newWidth * ratio);
            
            canvas.width = 800; // 内部像素宽度
            canvas.height = 600; // 内部像素高度
            
            canvas.style.width = `${newWidth}px`;
            canvas.style.height = `${newHeight}px`;
        }
        
        // 初始化时调整尺寸
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // 游戏变量
        let playerSnake = [];       // 玩家蛇
        let aiSnake = [];           // 电脑蛇
        let foods = [];             // 食物数组
        let playerDirection = '';   // 玩家蛇方向
        let playerNextDirection = ''; // 玩家蛇下一方向
        let aiDirection = '';       // 电脑蛇方向
        let playerScore = 0;        // 玩家分数
        let aiScore = 0;            // 电脑分数
        let gameSpeed = 150;        // 初始速度(毫秒)
        let gameInterval;           // 游戏主循环
        let foodInterval;           // 食物生成定时器
        let isGameRunning = false;  // 游戏运行状态
        let maxFoodCount = 6;       // 最大食物数量
        let gameTime = 0;           // 游戏运行时间(秒)
        let speedIncreaseInterval;  // 速度增加定时器
        
        // 蛇的初始位置和大小
        const gridSize = 20; // 网格大小
        
        // 显示屏幕
        function showScreen(screenElement) {
            screenElement.classList.remove('opacity-0', 'invisible');
            screenElement.classList.add('opacity-100', 'visible');
        }
        
        // 隐藏屏幕
        function hideScreen(screenElement) {
            screenElement.classList.remove('opacity-100', 'visible');
            screenElement.classList.add('opacity-0', 'invisible');
        }
        
        // 初始化游戏
        function initGame() {
            // 重置玩家蛇（左侧）
            const playerStartX = gridSize * 5;
            const playerStartY = Math.floor(canvas.height / 2 / gridSize) * gridSize;
            playerSnake = [
                { x: playerStartX, y: playerStartY },
                { x: playerStartX - gridSize, y: playerStartY },
                { x: playerStartX - gridSize * 2, y: playerStartY }
            ];
            
            // 重置电脑蛇（右侧）
            const aiStartX = canvas.width - gridSize * 5;
            const aiStartY = Math.floor(canvas.height / 2 / gridSize) * gridSize;
            aiSnake = [
                { x: aiStartX, y: aiStartY },
                { x: aiStartX + gridSize, y: aiStartY },
                { x: aiStartX + gridSize * 2, y: aiStartY }
            ];
            
            // 初始方向
            playerDirection = 'right';
            playerNextDirection = 'right';
            aiDirection = 'left';
            
            // 重置分数
            playerScore = 0;
            aiScore = 0;
            playerScoreElement.textContent = playerScore;
            aiScoreElement.textContent = aiScore;
            
            // 重置速度和时间
            gameSpeed = 150;
            gameTime = 0;
            
            // 清空食物并初始生成2个
            foods = [];
            generateFood(2);
            
            // 清除画布
            clearCanvas();
            
            // 绘制初始蛇和食物
            drawPlayerSnake();
            drawAiSnake();
            drawFoods();
        }
        
        // 生成食物
        function generateFood(count = 1) {
            // 确保不超过最大食物数量
            const needToGenerate = Math.min(count, maxFoodCount - foods.length);
            
            for (let i = 0; i < needToGenerate; i++) {
                let overlapping;
                let newFood;
                
                do {
                    overlapping = false;
                    // 随机生成食物位置
                    newFood = {
                        x: Math.floor(Math.random() * (canvas.width / gridSize)) * gridSize,
                        y: Math.floor(Math.random() * (canvas.height / gridSize)) * gridSize
                    };
                    
                    // 检查是否与玩家蛇重叠
                    for (let segment of playerSnake) {
                        if (segment.x === newFood.x && segment.y === newFood.y) {
                            overlapping = true;
                            break;
                        }
                    }
                    
                    // 检查是否与电脑蛇重叠
                    if (!overlapping) {
                        for (let segment of aiSnake) {
                            if (segment.x === newFood.x && segment.y === newFood.y) {
                                overlapping = true;
                                break;
                            }
                        }
                    }
                    
                    // 检查是否与现有食物重叠
                    if (!overlapping) {
                        for (let food of foods) {
                            if (food.x === newFood.x && food.y === newFood.y) {
                                overlapping = true;
                                break;
                            }
                        }
                    }
                } while (overlapping);
                
                foods.push(newFood);
            }
        }
        
        // 绘制玩家蛇
        function drawPlayerSnake() {
            playerSnake.forEach((segment, index) => {
                // 蛇头
                if (index === 0) {
                    ctx.fillStyle = '#16a34a'; // 更深的绿色
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = 'rgba(34, 197, 94, 0.7)';
                } else {
                    // 蛇身，根据位置改变颜色
                    const colorIntensity = 34 + (index * 5) > 197 ? 197 : 34 + (index * 5);
                    ctx.fillStyle = `rgb(34, ${colorIntensity}, 94)`;
                    ctx.shadowBlur = 0;
                }
                
                ctx.fillRect(segment.x, segment.y, gridSize - 1, gridSize - 1);
            });
            
            ctx.shadowBlur = 0;
        }
        
        // 绘制电脑蛇
        function drawAiSnake() {
            aiSnake.forEach((segment, index) => {
                // 蛇头
                if (index === 0) {
                    ctx.fillStyle = '#1e40af'; // 更深的蓝色
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = 'rgba(59, 130, 246, 0.7)';
                } else {
                    // 蛇身，根据位置改变颜色
                    const colorIntensity = 59 + (index * 5) > 246 ? 246 : 59 + (index * 5);
                    ctx.fillStyle = `rgb(30, 64, ${colorIntensity})`;
                    ctx.shadowBlur = 0;
                }
                
                ctx.fillRect(segment.x, segment.y, gridSize - 1, gridSize - 1);
            });
            
            ctx.shadowBlur = 0;
        }
        
        // 绘制所有食物
        function drawFoods() {
            foods.forEach(food => {
                ctx.fillStyle = '#ef4444'; // 红色食物
                ctx.shadowBlur = 10;
                ctx.shadowColor = 'rgba(239, 68, 68, 0.7)';
                
                // 绘制圆形食物
                ctx.beginPath();
                ctx.arc(
                    food.x + gridSize / 2,
                    food.y + gridSize / 2,
                    gridSize / 2 - 1,
                    0, 
                    Math.PI * 2
                );
                ctx.fill();
            });
            
            ctx.shadowBlur = 0;
        }
        
        // 清除画布
        function clearCanvas() {
            ctx.fillStyle = '#0f172a'; // 深色背景
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        // 移动玩家蛇
        function movePlayerSnake() {
            playerDirection = playerNextDirection;
            
            // 获取蛇头位置
            const head = { x: playerSnake[0].x, y: playerSnake[0].y };
            
            // 根据方向移动蛇头
            switch (playerDirection) {
                case 'up':
                    head.y -= gridSize;
                    break;
                case 'down':
                    head.y += gridSize;
                    break;
                case 'left':
                    head.x -= gridSize;
                    break;
                case 'right':
                    head.x += gridSize;
                    break;
            }
            
            // 将新头部添加到蛇的前面
            playerSnake.unshift(head);
            
            // 检查是否吃到食物
            let ateFood = false;
            for (let i = 0; i < foods.length; i++) {
                if (head.x === foods[i].x && head.y === foods[i].y) {
                    // 加分
                    playerScore += 10;
                    playerScoreElement.textContent = playerScore;
                    
                    // 移除被吃掉的食物
                    foods.splice(i, 1);
                    ateFood = true;
                    break;
                }
            }
            
            // 如果没吃到食物，移除尾部
            if (!ateFood) {
                playerSnake.pop();
            }
        }
        
        // 电脑蛇AI移动（可穿墙）
        function moveAiSnake() {
            // 随机改变方向（约20%概率）
            if (Math.random() < 0.2) {
                const possibleDirections = [];
                switch (aiDirection) {
                    case 'up':
                    case 'down':
                        possibleDirections.push('left', 'right');
                        break;
                    case 'left':
                    case 'right':
                        possibleDirections.push('up', 'down');
                        break;
                }
                // 有小概率继续原方向
                if (Math.random() < 0.3) {
                    possibleDirections.push(aiDirection);
                }
                // 随机选择一个方向
                aiDirection = possibleDirections[Math.floor(Math.random() * possibleDirections.length)];
            }
            
            // 获取蛇头位置
            const head = { x: aiSnake[0].x, y: aiSnake[0].y };
            
            // 根据方向移动蛇头
            switch (aiDirection) {
                case 'up':
                    head.y -= gridSize;
                    break;
                case 'down':
                    head.y += gridSize;
                    break;
                case 'left':
                    head.x -= gridSize;
                    break;
                case 'right':
                    head.x += gridSize;
                    break;
            }
            
            // 电脑蛇穿墙逻辑 - 从一边出去从另一边进来
            if (head.x < 0) {
                head.x = canvas.width - gridSize;
            } else if (head.x >= canvas.width) {
                head.x = 0;
            }
            
            if (head.y < 0) {
                head.y = canvas.height - gridSize;
            } else if (head.y >= canvas.height) {
                head.y = 0;
            }
            
            // 将新头部添加到蛇的前面
            aiSnake.unshift(head);
            
            // 检查是否吃到食物
            let ateFood = false;
            for (let i = 0; i < foods.length; i++) {
                if (head.x === foods[i].x && head.y === foods[i].y) {
                    // 加分
                    aiScore += 10;
                    aiScoreElement.textContent = aiScore;
                    
                    // 移除被吃掉的食物
                    foods.splice(i, 1);
                    ateFood = true;
                    break;
                }
            }
            
            // 如果没吃到食物，移除尾部
            if (!ateFood) {
                aiSnake.pop();
            }
        }
        
        // 检查玩家碰撞
        function checkPlayerCollision() {
            const head = playerSnake[0];
            
            // 检查是否撞墙
            if (
                head.x < 0 || 
                head.x >= canvas.width || 
                head.y < 0 || 
                head.y >= canvas.height
            ) {
                return true;
            }
            
            // 检查是否撞到自己
            for (let i = 1; i < playerSnake.length; i++) {
                if (head.x === playerSnake[i].x && head.y === playerSnake[i].y) {
                    return true;
                }
            }
            
            // 不检查与电脑蛇身体的碰撞，只在游戏主循环中检查头部碰撞
            
            return false;
        }
        
        // 检查电脑蛇自碰撞（电脑蛇不会因撞墙死亡）
        function checkAiSelfCollision() {
            const head = aiSnake[0];
            
            // 检查是否撞到自己
            for (let i = 1; i < aiSnake.length; i++) {
                if (head.x === aiSnake[i].x && head.y === aiSnake[i].y) {
                    return true;
                }
            }
            
            return false;
        }
        
        // 检查头部碰撞
        function checkHeadCollision() {
            const playerHead = playerSnake[0];
            const aiHead = aiSnake[0];
            
            // 检查两条蛇的头部是否相撞
            return playerHead.x === aiHead.x && playerHead.y === aiHead.y;
        }
        
        // 游戏主循环
        function gameLoop() {
            clearCanvas();
            
            // 移动两条蛇
            movePlayerSnake();
            moveAiSnake();
            
            // 检查碰撞
            const playerCollided = checkPlayerCollision();
            const aiSelfCollided = checkAiSelfCollision();
            const headsCollided = checkHeadCollision();
            
            // 游戏结束条件：玩家碰撞或头部相撞
            if (playerCollided || aiSelfCollided || headsCollided) {
                endGame(playerCollided, aiSelfCollided, headsCollided);
                return;
            }
            
            // 绘制所有元素
            drawPlayerSnake();
            drawAiSnake();
            drawFoods();
        }
        
        // 开始游戏
        function startGame() {
            if (!isGameRunning) {
                isGameRunning = true;
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                // 隐藏开始和结束屏幕
                hideScreen(startScreen);
                hideScreen(gameOverScreen);
                
                // 初始化游戏
                initGame();
                
                // 开始游戏循环
                gameInterval = setInterval(gameLoop, gameSpeed);
                
                // 设置食物生成定时器（每5秒生成2个食物）
                foodInterval = setInterval(() => {
                    generateFood(2);
                }, 5000);
                
                // 设置速度增加定时器（每30秒增加一次速度）
                speedIncreaseInterval = setInterval(() => {
                    gameTime += 30;
                    if (gameSpeed > 60) { // 最低速度限制
                        gameSpeed -= 10;
                        clearInterval(gameInterval);
                        gameInterval = setInterval(gameLoop, gameSpeed);
                    }
                }, 30000);
            }
        }
        
        // 暂停游戏
        function pauseGame() {
            if (isGameRunning) {
                isGameRunning = false;
                clearInterval(gameInterval);
                clearInterval(foodInterval);
                clearInterval(speedIncreaseInterval);
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                // 显示暂停信息
                ctx.fillStyle = 'rgba(30, 41, 59, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#22c55e';
                ctx.font = '24px "Press Start 2P", sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('游戏暂停', canvas.width / 2, canvas.height / 2);
            }
        }
        
        // 结束游戏
        function endGame(playerCollided, aiSelfCollided, headsCollided) {
            isGameRunning = false;
            clearInterval(gameInterval);
            clearInterval(foodInterval);
            clearInterval(speedIncreaseInterval);
            startBtn.disabled = false;
            pauseBtn.disabled = true;
            
            // 显示游戏结束屏幕
            finalPlayerScoreElement.textContent = playerScore;
            finalAiScoreElement.textContent = aiScore;
            showScreen(gameOverScreen);
        }
        
        // 处理方向控制
        function setPlayerDirection(newDirection) {
            // 防止180度转向
            if (
                (newDirection === 'up' && playerDirection !== 'down') ||
                (newDirection === 'down' && playerDirection !== 'up') ||
                (newDirection === 'left' && playerDirection !== 'right') ||
                (newDirection === 'right' && playerDirection !== 'left')
            ) {
                playerNextDirection = newDirection;
            }
        }
        
        // 处理键盘输入
        function handleKeyPress(e) {
            // 阻止按键滚动页面
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', ' '].includes(e.key)) {
                e.preventDefault();
            }
            
            // 方向控制
            switch (e.key) {
                case 'ArrowUp':
                    setPlayerDirection('up');
                    break;
                case 'ArrowDown':
                    setPlayerDirection('down');
                    break;
                case 'ArrowLeft':
                    setPlayerDirection('left');
                    break;
                case 'ArrowRight':
                    setPlayerDirection('right');
                    break;
                case ' ': // 空格键暂停/继续
                    if (isGameRunning) {
                        pauseGame();
                    } else if (startScreen.classList.contains('opacity-100')) {
                        startGame();
                    }
                    break;
            }
        }
        
        // 事件监听
        document.addEventListener('keydown', handleKeyPress);
        startBtn.addEventListener('click', startGame);
        pauseBtn.addEventListener('click', pauseGame);
        restartBtn.addEventListener('click', startGame);
        
        // 虚拟按键触摸事件
        upBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            setPlayerDirection('up');
        });
        
        downBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            setPlayerDirection('down');
        });
        
        leftBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            setPlayerDirection('left');
        });
        
        rightBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            setPlayerDirection('right');
        });
        
        // 防止移动设备触摸时的页面缩放
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        // 初始化显示
        initGame();
        showScreen(startScreen);
    </script>
</body>
</html>
